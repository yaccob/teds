$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://example.com/schemas/ecommerce.yaml"
title: "E-Commerce Platform Schema"
description: "Comprehensive schema for e-commerce platform with products, orders, customers, and inventory"

type: object
additionalProperties: false

properties:
  version:
    type: string
    pattern: "^\\d+\\.\\d+\\.\\d+$"
    description: "Schema version"
    examples: ["1.0.0"]

  metadata:
    $ref: "#/$defs/Metadata"

  customers:
    type: array
    items:
      $ref: "#/$defs/Customer"
    description: "Customer database"

  products:
    type: array
    items:
      $ref: "#/$defs/Product"
    description: "Product catalog"

  orders:
    type: array
    items:
      $ref: "#/$defs/Order"
    description: "Order management"

  inventory:
    type: array
    items:
      $ref: "#/$defs/InventoryItem"

required:
  - version
  - customers
  - products
  - orders

$defs:
  Metadata:
    type: object
    properties:
      created_at:
        type: string
        format: date-time
      updated_at:
        type: string
        format: date-time
      created_by:
        type: string
        format: email
      system_version:
        type: string
      environment:
        type: string
        enum: ["development", "staging", "production"]
    required: ["created_at", "environment"]

  Customer:
    type: object
    additionalProperties: false
    properties:
      customer_id:
        type: string
        format: uuid
        description: "Unique customer identifier"
      email:
        type: string
        format: email
        description: "Customer email address"
      name:
        $ref: "#/$defs/PersonName"
      phone:
        type: string
        pattern: "^\\+?[1-9]\\d{1,14}$"
        description: "E.164 format phone number"
      addresses:
        type: array
        items:
          $ref: "#/$defs/Address"
        maxItems: 5
      preferences:
        $ref: "#/$defs/CustomerPreferences"
      loyalty_tier:
        type: string
        enum: ["bronze", "silver", "gold", "platinum"]
        default: "bronze"
      created_at:
        type: string
        format: date-time
      last_login:
        type: string
        format: date-time
      total_spent:
        $ref: "#/$defs/Money"
    required:
      - customer_id
      - email
      - name
      - created_at
    examples:
      - customer_id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
        email: "alice@example.com"
        name:
          first_name: "Alice"
          last_name: "Johnson"
        phone: "+1234567890"
        loyalty_tier: "gold"
        created_at: "2023-01-15T10:30:00Z"

  PersonName:
    type: object
    properties:
      first_name:
        type: string
        minLength: 1
        maxLength: 50
      middle_name:
        type: string
        maxLength: 50
      last_name:
        type: string
        minLength: 1
        maxLength: 50
      suffix:
        type: string
        enum: ["Jr.", "Sr.", "II", "III", "IV"]
    required: ["first_name", "last_name"]

  Address:
    type: object
    properties:
      address_id:
        type: string
        format: uuid
      type:
        type: string
        enum: ["shipping", "billing", "both"]
      line1:
        type: string
        minLength: 1
        maxLength: 100
      line2:
        type: string
        maxLength: 100
      city:
        type: string
        minLength: 1
        maxLength: 50
      state:
        type: string
        minLength: 2
        maxLength: 50
      postal_code:
        type: string
        pattern: "^[0-9]{5}(-[0-9]{4})?$|^[A-Z][0-9][A-Z] [0-9][A-Z][0-9]$"
      country:
        type: string
        pattern: "^[A-Z]{2}$"
        description: "ISO 3166-1 alpha-2 country code"
      is_default:
        type: boolean
        default: false
    required: ["type", "line1", "city", "state", "postal_code", "country"]

  CustomerPreferences:
    type: object
    properties:
      marketing_emails:
        type: boolean
        default: true
      sms_notifications:
        type: boolean
        default: false
      preferred_language:
        type: string
        enum: ["en", "es", "fr", "de", "it", "pt", "ja", "zh"]
        default: "en"
      currency:
        type: string
        pattern: "^[A-Z]{3}$"
        default: "USD"
      notification_preferences:
        type: object
        properties:
          order_updates:
            type: boolean
            default: true
          promotions:
            type: boolean
            default: true
          recommendations:
            type: boolean
            default: false

  Product:
    type: object
    additionalProperties: false
    properties:
      product_id:
        type: string
        format: uuid
      sku:
        type: string
        pattern: "^[A-Z0-9-]{6,20}$"
        description: "Stock Keeping Unit"
      name:
        type: string
        minLength: 1
        maxLength: 200
      description:
        type: string
        maxLength: 2000
      category:
        $ref: "#/$defs/ProductCategory"
      brand:
        type: string
        maxLength: 100
      price:
        $ref: "#/$defs/Money"
      cost:
        $ref: "#/$defs/Money"
      weight:
        $ref: "#/$defs/Weight"
      dimensions:
        $ref: "#/$defs/Dimensions"
      images:
        type: array
        items:
          $ref: "#/$defs/ProductImage"
        maxItems: 10
      variants:
        type: array
        items:
          $ref: "#/$defs/ProductVariant"
      tags:
        type: array
        items:
          type: string
          maxLength: 50
        uniqueItems: true
      status:
        type: string
        enum: ["active", "inactive", "discontinued"]
        default: "active"
      created_at:
        type: string
        format: date-time
      updated_at:
        type: string
        format: date-time
    required:
      - product_id
      - sku
      - name
      - category
      - price
      - status
      - created_at

  ProductCategory:
    type: object
    properties:
      category_id:
        type: string
        format: uuid
      name:
        type: string
        minLength: 1
        maxLength: 100
      parent_category_id:
        type: string
        format: uuid
      level:
        type: integer
        minimum: 0
        maximum: 5
      path:
        type: string
        description: "Category hierarchy path"
        examples: ["/electronics/computers/laptops"]

  Money:
    type: object
    properties:
      amount:
        type: number
        minimum: 0
        multipleOf: 0.01
      currency:
        type: string
        pattern: "^[A-Z]{3}$"
        description: "ISO 4217 currency code"
    required: ["amount", "currency"]
    examples:
      - amount: 99.99
        currency: "USD"

  Weight:
    type: object
    properties:
      value:
        type: number
        minimum: 0
      unit:
        type: string
        enum: ["g", "kg", "oz", "lb"]
    required: ["value", "unit"]

  Dimensions:
    type: object
    properties:
      length:
        type: number
        minimum: 0
      width:
        type: number
        minimum: 0
      height:
        type: number
        minimum: 0
      unit:
        type: string
        enum: ["mm", "cm", "in", "ft"]
    required: ["length", "width", "height", "unit"]

  ProductImage:
    type: object
    properties:
      image_id:
        type: string
        format: uuid
      url:
        type: string
        format: uri
      alt_text:
        type: string
        maxLength: 200
      is_primary:
        type: boolean
        default: false
      order:
        type: integer
        minimum: 0
    required: ["image_id", "url"]

  ProductVariant:
    type: object
    properties:
      variant_id:
        type: string
        format: uuid
      sku:
        type: string
        pattern: "^[A-Z0-9-]{6,20}$"
      attributes:
        type: object
        additionalProperties:
          type: string
        examples:
          - color: "red"
            size: "large"
            material: "cotton"
      price_adjustment:
        $ref: "#/$defs/Money"
      inventory_count:
        type: integer
        minimum: 0
    required: ["variant_id", "sku", "attributes"]

  Order:
    type: object
    additionalProperties: false
    properties:
      order_id:
        type: string
        format: uuid
      order_number:
        type: string
        pattern: "^ORD-[0-9]{8}$"
      customer_id:
        type: string
        format: uuid
        description: "Reference to customer"
      status:
        type: string
        enum: ["pending", "confirmed", "processing", "shipped", "delivered", "cancelled", "refunded"]
      items:
        type: array
        items:
          $ref: "#/$defs/OrderItem"
        minItems: 1
      shipping_address:
        $ref: "#/$defs/Address"
      billing_address:
        $ref: "#/$defs/Address"
      payment:
        $ref: "#/$defs/Payment"
      shipping:
        $ref: "#/$defs/Shipping"
      totals:
        $ref: "#/$defs/OrderTotals"
      created_at:
        type: string
        format: date-time
      updated_at:
        type: string
        format: date-time
      notes:
        type: string
        maxLength: 1000
    required:
      - order_id
      - order_number
      - customer_id
      - status
      - items
      - shipping_address
      - payment
      - totals
      - created_at

  OrderItem:
    type: object
    properties:
      item_id:
        type: string
        format: uuid
      product_id:
        type: string
        format: uuid
      variant_id:
        type: string
        format: uuid
      sku:
        type: string
      name:
        type: string
        maxLength: 200
      quantity:
        type: integer
        minimum: 1
      unit_price:
        $ref: "#/$defs/Money"
      total_price:
        $ref: "#/$defs/Money"
      tax_amount:
        $ref: "#/$defs/Money"
    required:
      - item_id
      - product_id
      - sku
      - name
      - quantity
      - unit_price
      - total_price

  Payment:
    type: object
    properties:
      payment_id:
        type: string
        format: uuid
      method:
        type: string
        enum: ["credit_card", "debit_card", "paypal", "bank_transfer", "cryptocurrency"]
      status:
        type: string
        enum: ["pending", "authorized", "captured", "failed", "refunded"]
      amount:
        $ref: "#/$defs/Money"
      transaction_id:
        type: string
      processed_at:
        type: string
        format: date-time
    required: ["payment_id", "method", "status", "amount"]

  Shipping:
    type: object
    properties:
      shipping_id:
        type: string
        format: uuid
      method:
        type: string
        enum: ["standard", "express", "overnight", "pickup"]
      carrier:
        type: string
        examples: ["UPS", "FedEx", "USPS", "DHL"]
      tracking_number:
        type: string
      estimated_delivery:
        type: string
        format: date
      actual_delivery:
        type: string
        format: date-time
      cost:
        $ref: "#/$defs/Money"
    required: ["shipping_id", "method", "cost"]

  OrderTotals:
    type: object
    properties:
      subtotal:
        $ref: "#/$defs/Money"
      tax_amount:
        $ref: "#/$defs/Money"
      shipping_amount:
        $ref: "#/$defs/Money"
      discount_amount:
        $ref: "#/$defs/Money"
      total_amount:
        $ref: "#/$defs/Money"
    required:
      - subtotal
      - tax_amount
      - shipping_amount
      - total_amount

  InventoryItem:
    type: object
    properties:
      inventory_id:
        type: string
        format: uuid
      product_id:
        type: string
        format: uuid
      variant_id:
        type: string
        format: uuid
      sku:
        type: string
      location:
        $ref: "#/$defs/WarehouseLocation"
      quantity_available:
        type: integer
        minimum: 0
      quantity_reserved:
        type: integer
        minimum: 0
      reorder_point:
        type: integer
        minimum: 0
      reorder_quantity:
        type: integer
        minimum: 1
      last_updated:
        type: string
        format: date-time
    required:
      - inventory_id
      - product_id
      - sku
      - location
      - quantity_available
      - last_updated

  WarehouseLocation:
    type: object
    properties:
      warehouse_id:
        type: string
        format: uuid
      name:
        type: string
        maxLength: 100
      address:
        $ref: "#/$defs/Address"
      zone:
        type: string
        maxLength: 20
      aisle:
        type: string
        maxLength: 10
      shelf:
        type: string
        maxLength: 10
    required: ["warehouse_id", "name"]

examples:
  - version: "1.0.0"
    metadata:
      created_at: "2023-01-01T00:00:00Z"
      environment: "production"
    customers:
      - customer_id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
        email: "alice@example.com"
        name:
          first_name: "Alice"
          last_name: "Johnson"
        loyalty_tier: "gold"
        created_at: "2023-01-15T10:30:00Z"
    products:
      - product_id: "550e8400-e29b-41d4-a716-446655440000"
        sku: "LAP-DELL-XPS13"
        name: "Dell XPS 13 Laptop"
        category:
          category_id: "cat-electronics"
          name: "Electronics"
          level: 0
        price:
          amount: 999.99
          currency: "USD"
        status: "active"
        created_at: "2023-01-01T00:00:00Z"
    orders: []
