$schema: "https://json-schema.org/draft/2020-12/schema"
title: "Real Estate Management Schema"
type: object
properties:
  properties:
    type: array
    items:
      $ref: "#/$defs/Property"
  agents:
    type: array
    items:
      $ref: "#/$defs/Agent"
  listings:
    type: array
    items:
      $ref: "#/$defs/Listing"
  transactions:
    type: array
    items:
      $ref: "#/$defs/Transaction"
$defs:
  Property:
    type: object
    examples:
      - property_id: "550e8400-e29b-41d4-a716-446655440001"
        address:
          street: "1234 Oak Street"
          city: "Beverly Hills"
          state: "California"
          postal_code: "90210"
          country: "United States"
        property_type: "house"
        bedrooms: 4
        bathrooms: 3.5
        square_feet: 2850
        lot_size_sqft: 8000
        year_built: 2018
        features: ["pool", "garage", "fireplace", "hardwood_floors", "granite_countertops"]
        hoa_fee:
          amount: 250.00
          currency: "USD"
        property_taxes:
          amount: 12500.00
          currency: "USD"
        zoning: "residential"
        condition: "excellent"
        photos: ["https://example.com/photos/001.jpg", "https://example.com/photos/002.jpg"]
    properties:
      property_id:
        type: string
        format: uuid
      address:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Address"
      property_type:
        type: string
        enum: ["house", "apartment", "condo", "townhouse", "commercial", "land", "multi_family"]
      bedrooms:
        type: integer
        minimum: 0
        maximum: 20
      bathrooms:
        type: number
        minimum: 0
        maximum: 20
        multipleOf: 0.5
      square_feet:
        type: integer
        minimum: 100
      lot_size_sqft:
        type: integer
        minimum: 0
      year_built:
        type: integer
        minimum: 1800
        maximum: 2030
      features:
        type: array
        items:
          type: string
        uniqueItems: true
      hoa_fee:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      property_taxes:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      zoning:
        type: string
        enum: ["residential", "commercial", "industrial", "mixed_use", "agricultural"]
      condition:
        type: string
        enum: ["excellent", "good", "fair", "poor", "needs_repair"]
      photos:
        type: array
        items:
          type: string
          format: uri
        maxItems: 50
    required: ["property_id", "address", "property_type", "square_feet"]
  Agent:
    type: object
    examples:
      - agent_id: "550e8400-e29b-41d4-a716-446655440010"
        name:
          first_name: "Sarah"
          last_name: "Williams"
        email: "sarah.williams@premierrealty.com"
        phone: "+15551234567"
        license_number: "RE#01234567"
        brokerage: "Premier Realty Group"
        specialties: ["luxury", "residential"]
        years_experience: 8
        commission_rate: 0.03
        rating: 4.8
        total_sales: 127
    properties:
      agent_id:
        type: string
        format: uuid
      name:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/PersonName"
      email:
        type: string
        format: email
      phone:
        type: string
        pattern: "^\\+?[1-9]\\d{1,14}$"
      license_number:
        type: string
      brokerage:
        type: string
        maxLength: 100
      specialties:
        type: array
        items:
          type: string
          enum: ["residential", "commercial", "luxury", "first_time_buyers", "investment", "relocation"]
      years_experience:
        type: integer
        minimum: 0
      commission_rate:
        type: number
        minimum: 0
        maximum: 0.1
      rating:
        type: number
        minimum: 0
        maximum: 5
      total_sales:
        type: integer
        minimum: 0
    required: ["agent_id", "name", "email", "phone", "license_number", "brokerage"]
  Listing:
    type: object
    examples:
      - listing_id: "550e8400-e29b-41d4-a716-446655440020"
        property_id: "550e8400-e29b-41d4-a716-446655440001"
        agent_id: "550e8400-e29b-41d4-a716-446655440010"
        listing_type: "sale"
        price:
          amount: 1250000.00
          currency: "USD"
        price_per_sqft:
          amount: 438.60
          currency: "USD"
        status: "active"
        list_date: "2024-03-15"
        days_on_market: 45
        description: "Stunning 4-bedroom luxury home in prestigious Beverly Hills neighborhood. Features include gourmet kitchen, pool, and beautiful landscaping."
        virtual_tour_url: "https://example.com/virtual-tour/001"
        showing_instructions: "Please call listing agent 24 hours in advance"
        open_houses:
          - open_house_id: "550e8400-e29b-41d4-a716-446655440030"
            date: "2024-04-20"
            start_time: "14:00"
            end_time: "16:00"
            notes: "Refreshments will be provided"
    properties:
      listing_id:
        type: string
        format: uuid
      property_id:
        type: string
        format: uuid
      agent_id:
        type: string
        format: uuid
      listing_type:
        type: string
        enum: ["sale", "rent", "lease"]
      price:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      price_per_sqft:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      status:
        type: string
        enum: ["active", "pending", "sold", "expired", "withdrawn", "contingent"]
      list_date:
        type: string
        format: date
      days_on_market:
        type: integer
        minimum: 0
      description:
        type: string
        maxLength: 2000
      virtual_tour_url:
        type: string
        format: uri
      showing_instructions:
        type: string
        maxLength: 500
      open_houses:
        type: array
        items:
          $ref: "#/$defs/OpenHouse"
    required: ["listing_id", "property_id", "agent_id", "listing_type", "price", "status", "list_date"]
  OpenHouse:
    type: object
    properties:
      open_house_id:
        type: string
        format: uuid
      date:
        type: string
        format: date
      start_time:
        type: string
        pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
      end_time:
        type: string
        pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
      notes:
        type: string
        maxLength: 200
    required: ["open_house_id", "date", "start_time", "end_time"]
  Transaction:
    type: object
    properties:
      transaction_id:
        type: string
        format: uuid
      listing_id:
        type: string
        format: uuid
      buyer_agent_id:
        type: string
        format: uuid
      seller_agent_id:
        type: string
        format: uuid
      buyer_info:
        $ref: "#/$defs/PartyInfo"
      seller_info:
        $ref: "#/$defs/PartyInfo"
      offer_price:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      final_price:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      financing:
        $ref: "#/$defs/Financing"
      contingencies:
        type: array
        items:
          type: string
          enum: ["inspection", "appraisal", "financing", "sale_of_home"]
      closing_date:
        type: string
        format: date
      status:
        type: string
        enum: ["offer_made", "under_contract", "contingent", "pending", "closed", "cancelled"]
      commission:
        $ref: "#/$defs/Commission"
    required: ["transaction_id", "listing_id", "buyer_agent_id", "seller_agent_id", "offer_price", "status"]
  PartyInfo:
    type: object
    properties:
      name:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/PersonName"
      email:
        type: string
        format: email
      phone:
        type: string
        pattern: "^\\+?[1-9]\\d{1,14}$"
      address:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Address"
    required: ["name", "email", "phone"]
  Financing:
    type: object
    properties:
      financing_type:
        type: string
        enum: ["cash", "conventional", "fha", "va", "usda", "other"]
      loan_amount:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      down_payment:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      interest_rate:
        type: number
        minimum: 0
        maximum: 0.3
      loan_term_years:
        type: integer
        enum: [15, 20, 25, 30]
      lender:
        type: string
        maxLength: 100
      pre_approved:
        type: boolean
    required: ["financing_type"]
  Commission:
    type: object
    properties:
      total_commission:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      buyer_agent_commission:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      seller_agent_commission:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      brokerage_split:
        type: number
        minimum: 0
        maximum: 1
    required: ["total_commission", "buyer_agent_commission", "seller_agent_commission"]
