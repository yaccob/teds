$schema: "https://json-schema.org/draft/2020-12/schema"
title: "Cryptocurrency Exchange Schema"
type: object
properties:
  users:
    type: array
    items:
      $ref: "#/$defs/User"
  wallets:
    type: array
    items:
      $ref: "#/$defs/Wallet"
  transactions:
    type: array
    items:
      $ref: "#/$defs/Transaction"
  cryptocurrencies:
    type: array
    items:
      $ref: "#/$defs/Cryptocurrency"
$defs:
  User:
    type: object
    properties:
      user_id:
        type: string
        format: uuid
      email:
        type: string
        format: email
      name:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/PersonName"
      kyc_status:
        type: string
        enum: ["pending", "verified", "rejected"]
      two_factor_enabled:
        type: boolean
        default: false
      registration_date:
        type: string
        format: date-time
      last_login:
        type: string
        format: date-time
      tier:
        type: string
        enum: ["basic", "intermediate", "advanced"]
      daily_withdrawal_limit:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
    required: ["user_id", "email", "name", "kyc_status", "registration_date", "tier"]
  Wallet:
    type: object
    properties:
      wallet_id:
        type: string
        format: uuid
      user_id:
        type: string
        format: uuid
      cryptocurrency_id:
        type: string
        format: uuid
      address:
        type: string
      balance:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
      available_balance:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
      frozen_balance:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
      created_date:
        type: string
        format: date-time
      last_updated:
        type: string
        format: date-time
    required: ["wallet_id", "user_id", "cryptocurrency_id", "address", "balance", "available_balance", "frozen_balance"]
  Transaction:
    type: object
    properties:
      transaction_id:
        type: string
        format: uuid
      user_id:
        type: string
        format: uuid
      transaction_type:
        type: string
        enum: ["deposit", "withdrawal", "trade", "transfer"]
      cryptocurrency_id:
        type: string
        format: uuid
      amount:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
      fee:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
      status:
        type: string
        enum: ["pending", "confirmed", "failed", "cancelled"]
      blockchain_hash:
        type: string
      confirmation_count:
        type: integer
        minimum: 0
      timestamp:
        type: string
        format: date-time
      from_address:
        type: string
      to_address:
        type: string
      network_fee:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
    required: ["transaction_id", "user_id", "transaction_type", "cryptocurrency_id", "amount", "status", "timestamp"]
  Cryptocurrency:
    type: object
    properties:
      cryptocurrency_id:
        type: string
        format: uuid
      symbol:
        type: string
        pattern: "^[A-Z]{2,10}$"
      name:
        type: string
        maxLength: 50
      network:
        type: string
        enum: ["bitcoin", "ethereum", "binance_smart_chain", "polygon", "avalanche", "solana", "cardano"]
      contract_address:
        type: string
      decimals:
        type: integer
        minimum: 0
        maximum: 18
      total_supply:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
      circulating_supply:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
      market_cap:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      current_price:
        $ref: "../ecommerce_platform/ecommerce.yaml#/$defs/Money"
      price_24h_change:
        type: number
      active:
        type: boolean
        default: true
      minimum_withdrawal:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
      withdrawal_fee:
        type: string
        pattern: "^[0-9]+\\.?[0-9]*$"
    required: ["cryptocurrency_id", "symbol", "name", "network", "decimals", "current_price", "active"]
