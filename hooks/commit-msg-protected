#!/usr/bin/env bash
# Enhanced Commit-Msg Hook with Bypass Protection
# Copy this to .git/hooks/commit-msg and make executable
#
# Installation: cp hooks/commit-msg-protected .git/hooks/commit-msg && chmod +x .git/hooks/commit-msg

# Check if this is a bypass attempt by looking at environment variables
if [ -n "$PRE_COMMIT_ALLOW_NO_CONFIG" ] || [ -n "$SKIP" ]; then
    echo "ğŸš« ERROR: Hook bypass attempt detected in commit-msg hook!"
    echo "ğŸ’¡ Even --no-verify cannot bypass this protection"
    echo "ğŸ›¡ï¸  Quality gates are mandatory for all commits"
    exit 1
fi

# Check for suspicious commit messages that might indicate bypass attempts
if grep -qiE "(bypass|skip.*hook|no-verify|allow.*config)" "$1"; then
    echo "âš ï¸  WARNING: Commit message suggests hook bypass attempt"
    echo "ğŸ’¡ Commit message: $(cat "$1")"
    echo "ğŸ›¡ï¸  Please ensure all quality checks have been performed"
fi

echo "ğŸ›¡ï¸ Commit message validation passed"
exit 0
